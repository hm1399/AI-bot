# AI-Bot 桌面AI助手 - 工作日志

---

## 2026-02-04（Day 1）- 项目启动与功能规划

### 项目初始化
- 创建GitHub仓库，建立项目基础目录结构
- 编写README.md项目简介

### 功能讨论
- 确定产品定位：桌面AI助手，硬件设备通过WiFi与电脑服务端通信
- 讨论核心功能：语音对话、电脑控制、时间天气显示
- 编写`功能讨论区/功能实现讨论.md`，详细分析各功能实现方案

### 技术调研
- 调研OpenClaw（700+ Skills电脑控制框架），记录于`功能讨论区/openClaw.md`
- 调研NeoAI项目，记录于`功能讨论区/NeoAI.md`
- 确定软件技术栈：Python + FastAPI + Whisper + Edge-TTS + GPT-4/Claude API

---

## 2026-02-05（Day 2）- 元件选型与任务规划

### 元件选择
- 确定主控方案：ESP32-S3-WROOM-1-N16R8（16MB Flash + 8MB PSRAM）
- 确定音频方案：INMP441（I2S数字麦克风）+ MAX98357A（I2S D类功放）+ 3W 4Ω喇叭
- 确定显示方案：1.69寸 IPS TFT ST7789（SPI接口）
- 确定传感器：MPU6050六轴陀螺仪（I2C），用于摇一摇检测
- 确定电源方案：TP4056（锂电池充电）+ AMS1117-3.3（LDO稳压）
- 确定交互方案：TTP223触摸 + 轻触开关（后续被替换，见2月9日）

### 引脚分配
- 完成ESP32-S3全部引脚分配规划
- 明确N16R8模组限制：GPIO22~37被内部Octal SPI Flash/PSRAM占用，不可使用

### 任务规划
- 编写`功能讨论区/task.md` MVP任务清单
- 划分八大阶段：硬件采购 → 环境搭建 → 模块调试 → 硬件整合 → 原理图PCB → 固件开发 → 服务端开发 → 联调测试

### 元件资料收集
- 收集关键元件的PDF数据手册（TP4056、ST7789等）
- 建立`元件资料区/`和`元件TXT/`目录，归档数据手册

---

## 2026-02-05~08（Day 2~5）- 原理图设计（逐步完成）

### 原理图模块设计

在嘉立创EDA中逐步完成全部7个硬件模块的原理图，同步编写设计教程文档存放于`原理图设计/`目录：

**01_ESP32-S3最小系统**
- 设计ESP32-S3-WROOM-1-N16R8最小启动电路
- 包含：3V3供电去耦、EN复位按键（RC延时）、IO0下载模式按键、USB Type-C接口

**02_INMP441麦克风**
- I2S接口连接：SCK=IO14, WS=IO15, SD=IO16
- L/R引脚接GND选择左声道

**03_MAX98357A功放**
- I2S接口连接：BCLK=IO17, LRC=IO18, DIN=IO8
- GAIN引脚配置增益，SD引脚上拉使能

**04_ST7789显示屏**
- SPI接口连接：SCK=IO12, MOSI=IO11, DC=IO10, CS=IO9, RST=IO46
- 背光LED驱动电路

**05_电源管理**
- TP4056锂电池充电管理：PROG电阻1.2KΩ设定1A充电电流，TEMP接GND禁用温度检测
- AMS1117-3.3 LDO稳压：VBAT → 开关 → AMS1117 → 3V3
- USB Type-C 5V输入，锂电池3.7V中间储能

**06_MPU6050陀螺仪**
- I2C接口连接：SDA=IO5, SCL=IO6
- AD0接GND设定I2C地址0x68
- INT中断输出接IO4
- 采用邮票孔模块方案

**07_触摸与交互**
- 设计变更：取消TTP223外部触摸芯片 + 轻触开关方案
- 改用ESP32-S3内置14通道电容触摸传感器
- 主触摸板IO7（TOUCH_MAIN），备用IO1/IO2/IO3/IO13
- 每通道仅需1个4.7KΩ串联电阻做ESD保护
- 净减少5~7个元件

### 关键设计决策
- ESP32-S3内置触摸替代TTP223+按键，大幅简化BOM和PCB面积
- 触摸焊盘设计要点：8~12mm铜皮、走线<50mm、焊盘下方不铺地
- 支持Deep Sleep触摸唤醒，适合低功耗场景

---

## 2026-02-09（Day 6）- PCB布局布线

### PCB设计
- 完成PCB布局布线
- 所有模块原理图转PCB，元件摆放与走线完成

---

## 2026-02-10（Day 7）- 设计优化与评审

### 电源模块优化
- 确定去掉TP4056充电指示LED（红色充电中 + 绿色充满）
- 改为软件方案：CHRG/STDBY引脚接GPIO（IO38/IO39），通过10KΩ上拉到3V3读取充电状态
- 屏幕显示充电UI，类似手机关机充电画面
- CHRG引脚低电平可唤醒Deep Sleep，插USB自动亮屏显示充电动画
- 净减少2个LED + 2个1KΩ电阻，新增2个10KΩ上拉电阻
- 拨动开关SW1定位为"仓储开关"，日常保持ON，用Deep Sleep作为"关机"
- 编写变更文档 `原理图设计/08_电源LED改GPIO充电检测.md`

### 触摸设计确认
- 确认单个大铜皮触摸焊盘方案：焊盘悬浮不接地，仅通过4.7K电阻连ESP32-S3
- GND保护环为可选项，单触摸板场景不需要

---

## 当前状态

**阶段：** PCB布局布线已完成，设计优化中

**已完成：**
- [x] 项目规划与功能定义
- [x] 全部元件选型
- [x] 引脚分配规划
- [x] 7个模块原理图设计文档
- [x] 触摸方案优化（TTP223 → ESP32-S3内置触摸）
- [x] 在嘉立创EDA中绘制完整原理图
- [x] PCB布局布线
- [x] 电源LED优化（硬件LED → 软件UI + GPIO检测）

**待完成：**
- [ ] 原理图/PCB同步更新（充电LED改GPIO等变更）
- [ ] 原理图审查（ERC检查）
- [ ] PCB审查（DRC检查）
- [ ] 打样、焊接、调试
- [ ] 固件开发
- [ ] 服务端开发
- [ ] 系统联调

---

## 引脚分配总览

| 引脚 | 功能 | 模块 |
|------|------|------|
| IO1 | TOUCH_UP（备用触摸） | 触摸交互 |
| IO2 | TOUCH_DOWN（备用触摸） | 触摸交互 |
| IO3 | 备用触摸 | 触摸交互 |
| IO4 | MPU6050中断 | 陀螺仪 |
| IO5 | I2C_SDA | 陀螺仪 |
| IO6 | I2C_SCL | 陀螺仪 |
| IO7 | TOUCH_MAIN（主触摸） | 触摸交互 |
| IO8 | I2S_DOUT（功放DIN） | MAX98357A |
| IO9 | SPI_CS | ST7789 |
| IO10 | SPI_DC | ST7789 |
| IO11 | SPI_MOSI | ST7789 |
| IO12 | SPI_SCK | ST7789 |
| IO13 | 备用触摸 | 触摸交互 |
| IO14 | I2S_SCK（麦克风） | INMP441 |
| IO15 | I2S_WS（麦克风） | INMP441 |
| IO16 | I2S_SD（麦克风） | INMP441 |
| IO17 | I2S_BCLK（功放） | MAX98357A |
| IO18 | I2S_LRC（功放） | MAX98357A |
| IO19 | USB D- | USB（固定） |
| IO20 | USB D+ | USB（固定） |
| IO38 | CHG_STATUS（充电检测） | 电源管理 |
| IO39 | CHG_DONE（充满检测） | 电源管理 |
| IO46 | SPI_RST | ST7789 |
