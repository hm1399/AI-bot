# 电源管理电路原理图设计教程（TP4056 + AMS1117-3.3）

> 面向零基础用户，一步步教你在嘉立创EDA中画出电源管理电路的原理图。
> 每一步不仅告诉你"怎么接"，还解释"为什么这么接"和"还有什么别的接法"。

---

## 模块简介

**电源管理电路就是你设备的"供电系统"**，干三件事：

1. **充电**（TP4056）：USB插上的时候，把5V电转换成合适的电流给锂电池充电，充满自动停
2. **稳压**（AMS1117-3.3）：把锂电池的3.7~4.2V不稳定电压，变成稳定的3.3V给ESP32-S3和其他芯片用
3. **开关**（拨动开关）：让你可以手动关机省电

整个电源的路径是这样的：

```text
USB Type-C 5V ──→ TP4056充电芯片 ──→ 3.7V锂电池
                                         │
                                    [拨动开关]
                                         │
                                    AMS1117-3.3 ──→ 3.3V稳定电源
                                                       │
                                               ESP32-S3 + 所有芯片
```

---

## 你需要准备的元件清单

在嘉立创EDA中，你需要放置以下元件：

### 主要芯片

| 序号 | 元件 | 型号/参数 | 封装 | 数量 | 在嘉立创搜索 |
|------|------|-----------|------|------|-------------|
| U1 | 充电管理芯片 | UMW TP4056 (ESOP-8) | ESOP-8 | 1 | 搜 `TP4056`，选UMW友台版 |
| U2 | 稳压芯片 | AMS1117-3.3 | SOT-223 | 1 | 搜 `AMS1117-3.3` 或 `C6186` |

### 电阻

| 序号 | 元件 | 参数 | 封装 | 数量 | 用途 |
|------|------|------|------|------|------|
| R1 | 充电电流编程电阻 | 1.2KΩ / 1% | 0603 | 1 | 设定TP4056充电电流≈1000mA |
| R2 | 红色LED限流电阻 | 1KΩ | 0603 | 1 | 充电指示LED限流 |
| R3 | 绿色LED限流电阻 | 1KΩ | 0603 | 1 | 充满指示LED限流 |

### 电容

| 序号 | 元件 | 参数 | 封装 | 数量 | 用途 |
|------|------|------|------|------|------|
| C1 | TP4056输入去耦电容 | 10µF / 10V | 0805 | 1 | 稳定USB输入电源 |
| C2 | TP4056输出去耦电容 | 10µF / 10V | 0805 | 1 | 稳定电池端电压 |
| C3 | AMS1117输入电容 | 10µF / 10V | 0805 | 1 | 稳定稳压器输入 |
| C4 | AMS1117输出电容 | 22µF / 10V | 0805 | 1 | 稳压器稳定性必需 |

### 其他

| 序号 | 元件 | 参数 | 封装 | 数量 | 用途 |
|------|------|------|------|------|------|
| LED1 | 红色LED | 0603 | 0603 | 1 | 充电中指示 |
| LED2 | 绿色LED | 0603 | 0603 | 1 | 充满指示 |
| SW1 | 拨动开关 | SS-12D00 或类似 | 直插/贴片 | 1 | 电源总开关 |
| BAT1 | 锂电池接口 | JST-PH 2.0mm 2P卧式贴片座 | SMD | 1 | 连接锂电池（3.7V 1200mAh 103035软包，带保护板） |

**总计：2个芯片 + 3个电阻 + 4个电容 + 2个LED + 1个开关 + 1个电池接口**

---

## 整体电路连接概览

先看一眼完整的连接关系，后面一步步教你画：

```text
                         TP4056 充电芯片
                    ┌────────────────────┐
    5VUSB(5V) ──────┤ VCC(4)     BAT(5)  ├──────── VBAT (电池+)
                    │                    │            │
                    │ TEMP(1)──→GND      │          [电池]
                    │                    │            │
                    │ PROG(2)──→R1──→GND │          GND (电池-)
                    │                    │
                    │ CHRG(7)──→R2──→LED1(红)──→5VUSB
                    │                    │
                    │ STDBY(6)─→R3──→LED2(绿)──→5VUSB
                    │                    │
                    │ CE(8)───→5VUSB      │
                    │                    │
                    │ GND(3)───→GND      │
                    └────────────────────┘

                                VBAT
                                 │
                            [SW1 拨动开关]
                                 │
                              VBAT_SW (开关后的电池电压)
                                 │
                    ┌────────────────────┐
                    │ VIN(3)   VOUT(2)   │
                    │   AMS1117-3.3      ├──────── 3V3 (给所有芯片)
                    │ GND(1)             │
                    └────────────────────┘
                         │
                        GND
```

---

## 分步操作指南

### 第1步：放置TP4056充电芯片

#### 操作

1. 点击右侧 **"元件库"** 面板（或快捷键 `Shift+F`）
2. 在搜索框输入：`TP4056`，选择 UMW 友台半导体版本（ESOP-8封装）
3. 找到 **TP4056 ESOP-8**，点击 **"放置"**
4. 在画布的**左半部分**点击放下，这是充电区域

> 注意：TP4056有多个厂家生产（南京拓品TOPPOWER、友台UMW等），引脚兼容但内部参数略有不同。我们用的是**UMW友台版**，充电电流公式是 `I = 1200 / R`。如果你买到的是TOPPOWER版（嘉立创C16581），公式是 `I = 1100 / R`，需要调整R1的值。

#### 认识TP4056的8个引脚

放好后你会看到一个8脚芯片，先认识每个引脚的作用：

| 引脚号 | 引脚名 | 它在芯片内部干什么 | 我们怎么接 |
|--------|--------|-------------------|-----------|
| 1 | **TEMP** | 检测电池温度的。芯片通过这个引脚读取电池上NTC热敏电阻的电压，如果温度太高/太低就停止充电 | 我们的电池没有NTC，所以**接GND**（相当于告诉芯片"温度永远正常，放心充"） |
| 2 | **PROG** | 编程引脚。芯片内部用这个引脚上的电阻值来计算充电电流。公式是 `充电电流 = 1200 / R`，R是这个引脚到GND的电阻（单位KΩ和mA） | 接**1.2KΩ电阻到GND**，充电电流≈1000mA |
| 3 | **GND** | 芯片的地（负极），芯片内部所有电路的参考0电位 | 接**GND** |
| 4 | **VCC** | 芯片的供电输入，需要4V~6.5V。芯片从这里取电来给电池充电 | 接**5VUSB**（来自USB的5V） |
| 5 | **BAT** | 电池连接引脚。芯片通过这个引脚向电池输出充电电流，同时监测电池电压（充到4.2V就停） | 接**电池正极（VBAT）** |
| 6 | **STDBY** | 充满指示（开漏输出）。充满电后，芯片内部把这个引脚拉到GND | 通过电阻接**绿色LED** |
| 7 | **CHRG** | 充电中指示（开漏输出）。正在充电时，芯片内部把这个引脚拉到GND | 通过电阻接**红色LED** |
| 8 | **CE** | 芯片使能引脚。高电平=正常工作，低电平=休眠（停止充电，耗电极低） | 接**5VUSB**（插上USB就自动开始充电） |

---

### 第2步：连接TP4056的VCC引脚（电源输入）

#### 操作

1. 在TP4056的 **VCC（引脚4）** 旁边，放置一个网络标签 `5VUSB`
   - 快捷键 `N` → 输入 `5VUSB` → 点击放置 → 连到引脚4
2. 在VCC引脚附近放置 **电容C1（10µF）**
   - 搜索 `10uF`，选 **0805封装、耐压10V以上** 的电容
   - 一端接 `5VUSB`（VCC引脚），另一端接 `GND`

```text
5VUSB ──┬──── VCC (引脚4, TP4056)
       │
     C1 (10µF)
       │
      GND
```

#### 为什么要加C1（10µF输入电容）？

USB线很长（可能1~2米），线上有电感和电阻。当TP4056突然需要大电流（比如刚开始充电的瞬间），USB线来不及送电过来，电压会瞬间下降（就像水管太长，突然打开水龙头的瞬间水压会降低）。

C1就是VCC引脚旁边的**"蓄水池"**——它预先存好一些电，当芯片突然需要电的时候，电容立刻补上，USB线那边的电慢慢跟上来。

#### 为什么是10µF不是100nF？

TP4056的充电电流最高1A，这是比较大的电流。100nF（0.1µF）太小了，像一个茶杯大小的蓄水池，瞬间就用光了。10µF才能存够"水"来应对1A充电电流的波动。

> 数据手册的典型应用电路也推荐VCC端用 ≥1µF 的电容（陶瓷电容），10µF是常见选择。

#### 还有什么替代方案？

- **4.7µF**：最低要求，省空间但裕量小
- **10µF**（我们的选择）：够用、性价比高
- **22µF**：更充裕，适合USB线特别长或充电电流满1A的情况

---

### 第3步：连接TP4056的BAT引脚（电池输出）

#### 操作

1. 在TP4056的 **BAT（引脚5）** 旁边，放置一个网络标签 `VBAT`
2. 在BAT引脚附近放置 **电容C2（10µF）**
   - 一端接 `VBAT`，另一端接 `GND`
3. 放置 **电池接口BAT1**（JST-PH 2.0mm 2P母座）
   - 搜索 `JST PH 2P` 或 `PH-2A`，选择 **卧式贴片（SMD）** 版本
   - 正极接 `VBAT`，负极接 `GND`
   - 电池规格：3.7V 1200mAh 103035 软包锂聚合物电池（带保护板），出线为 JST-PH 2.0mm 公头

> **极性警告**：JST-PH 接口没有统一的正负极标准，不同电池厂家的红线（正极）可能在左边或右边。拿到电池后**必须用万用表确认正负极**，PCB 丝印上要标清 `+` 和 `-`。

```text
BAT (引脚5, TP4056) ──┬──── VBAT
                       │        │
                     C2 (10µF)  ├── BAT1正极 ──→ 锂电池+
                       │        │
                      GND      BAT1负极 ──→ 锂电池-
                                │
                               GND
```

#### 为什么BAT端也要加电容C2？

电池虽然本身就像一个超大电容（能存很多电），但电池有内阻。当充电电流在CC（恒流）和CV（恒压）模式之间切换时，电池电压会有小的波动。C2帮助平滑这些波动，让TP4056的内部控制回路工作更稳定。

另外，如果电池没接（调试的时候经常这样），C2可以让BAT引脚有一个基本的电压缓冲，防止引脚完全悬空导致芯片行为异常。

#### 为什么是10µF？

和输入端一样的道理——1A的充电电流需要足够大的电容来平滑。数据手册也推荐 ≥1µF。

---

### 第4步：连接PROG引脚（设定充电电流）

#### 操作

1. 放置 **电阻R1（1.2KΩ, 1%精度）**
   - 搜索 `1.2K 0603 1%`
   - 一端接 TP4056的 **PROG（引脚2）**
   - 另一端接 **GND**

```text
PROG (引脚2, TP4056) ──── R1 (1.2KΩ) ──── GND
```

#### 为什么要加R1？这个电阻干什么？

TP4056内部有一个精密的电流源，它通过PROG引脚上的电压和电阻来"感知"应该输出多大的充电电流。

芯片内部的控制逻辑是这样的：它在PROG引脚上维持一个约1V的电压，然后通过欧姆定律 `I = V / R`，电流流过PROG电阻。芯片把这个电流放大1200倍，就是充电电流：

**充电电流 = 1200 / RPROG（KΩ）= 1200 / 1.2 = 1000mA**

所以这个电阻就像一个"旋钮"，**电阻越小，充电电流越大**。

#### 为什么选1.2KΩ？

UMW版TP4056的数据手册明确给出：**RPROG=1.2KΩ时，充电电流=1000mA**。这正好是芯片的标称满载充电电流。

如果你担心满载发热，可以用稍大的电阻降低电流：

- **1.2KΩ → 1000mA**（我们的选择）：UMW版的标准1A充电设定，数据手册推荐值
- **2.4KΩ → 500mA**：如果你的电池很小（比如500mAh以下），用这个更安全。一般来说充电电流不要超过电池容量的1C（1000mAh的电池最大1A）
- **6KΩ → 200mA**：慢速充电，适合小电池或需要延长电池寿命的场景
- **12KΩ → 100mA**：超慢速充电，适合极小电池

> **重要**：这个电阻要用**1%精度**的，因为充电电流直接和它的阻值成反比。如果用5%精度的电阻，1.2KΩ可能实际是1.14K~1.26K，充电电流在952mA~1053mA之间波动。UMW版数据手册标注充电电流误差±10%，所以1%电阻已经足够精确。

---

### 第5步：连接TEMP引脚（温度监测）

#### 操作

1. 在TP4056的 **TEMP（引脚1）** 直接连一根线到 **GND**

```text
TEMP (引脚1, TP4056) ──── GND
```

#### 为什么接GND？

TEMP引脚本来是用来接电池上的NTC（负温度系数热敏电阻）的。芯片通过检测TEMP引脚的电压来判断电池温度：
- 电压低于VCC的45% → 温度太高，停止充电
- 电压高于VCC的80% → 温度太低，停止充电

当TEMP接GND（电压=0V，低于45%），按理说芯片应该认为"温度太高"而停止充电。但TP4056的数据手册明确说了：**"The temperature sense function can be disabled by grounding the TEMP pin"**——接GND就是禁用温度检测功能。

这是芯片内部的一个特殊逻辑：它识别出TEMP引脚直接接地（电压为0），知道你不想用温度监测功能，于是跳过温度检查，直接充电。

#### 如果电池有NTC怎么办？

如果你以后买了带NTC的电池，可以把TEMP引脚改成接电池的NTC端子，并加两个分压电阻（R1和R2），形成一个分压网络。但对于我们这个项目，接GND就够了。

---

### 第6步：连接CE引脚（芯片使能）

#### 操作

1. 在TP4056的 **CE（引脚8）** 连到 **5VUSB**

```text
CE (引脚8, TP4056) ──── 5VUSB
```

#### 为什么CE接5VUSB？

CE = Chip Enable（芯片使能）。高电平=工作，低电平=休眠。

我们把CE接到5VUSB（USB的5V），意思是：**插上USB就自动开始充电，拔掉USB就自动停止**。这是最简单最直观的方式。

#### 还有什么其他接法？

- **接一个GPIO**（比如ESP32-S3的某个IO引脚）：你可以通过软件控制是否充电。比如电池只剩10%时才允许充电，或者通过APP控制。但这会占用一个GPIO，而且增加软件复杂度
- **接一个物理按键**：按下按键才充电。用处不大，谁会不想充电呢？
- **接VCC（通过一个下拉电阻）**：默认不充电，需要外部信号才启动充电。工业设备会这么用

---

### 第7步：连接GND引脚

#### 操作

1. 在TP4056的 **GND（引脚3）** 放置一个 `GND` 电源符号

```text
GND (引脚3, TP4056) ──── GND
```

这个没什么可解释的——地就是地，所有电路共用的参考零电位。

---

### 第8步：连接LED充电指示灯

#### 操作

TP4056有两个状态输出引脚，都是**开漏输出**（这个概念下面解释）：

**红色LED（正在充电）：**

1. 放置一个 **红色LED**（搜索 `0603 红色 LED`）
2. 放置一个 **1KΩ电阻R2**（搜索 `1K 0603`）
3. 连接方式：`5VUSB → R2(1KΩ) → LED1(红)阳极 → LED1阴极 → CHRG(引脚7)`

**绿色LED（充满电）：**

1. 放置一个 **绿色LED**（搜索 `0603 绿色 LED`）
2. 放置一个 **1KΩ电阻R3**（搜索 `1K 0603`）
3. 连接方式：`5VUSB → R3(1KΩ) → LED2(绿)阳极 → LED2阴极 → STDBY(引脚6)`

```text
         R2 (1KΩ)    LED1 (红色)
5VUSB ────┤├────────→|────── CHRG (引脚7, TP4056)

         R3 (1KΩ)    LED2 (绿色)
5VUSB ────┤├────────→|────── STDBY (引脚6, TP4056)

（→| 表示LED，左边是阳极+，右边是阴极-）
```

#### 什么是"开漏输出"？为什么LED要这样接？

普通引脚有两种状态：输出高电平（接通到VCC）和输出低电平（接通到GND）。

开漏输出不一样——它只有一种"主动"状态：**拉低到GND**。另一种状态是**断开（高阻抗）**，就像开路了，什么都不接。

所以：
- **充电中**：CHRG引脚被拉到GND → 电流从5VUSB经过电阻R2、LED1，流到GND → **红灯亮**
- **充满了**：STDBY引脚被拉到GND → 电流从5VUSB经过电阻R3、LED2，流到GND → **绿灯亮**
- **没插USB**：没有5VUSB供电，两个LED都不亮

#### 为什么限流电阻是1KΩ？

LED的正向电压降大约2V（红色）或3V（绿色），5VUSB是5V。通过欧姆定律：

- 红色LED：I = (5V - 2V) / 1KΩ = 3mA — 够亮了
- 绿色LED：I = (5V - 3V) / 1KΩ = 2mA — 够亮了

0603的小LED只需要1~5mA就很亮了。如果用太小的电阻（比如100Ω），电流30mA，LED会刺眼而且发热。

#### 为什么LED接到5VUSB而不是3V3？

因为LED指示灯是用来显示**充电状态**的，只有插USB充电的时候才需要看到。拔掉USB（用电池供电时），5VUSB没有电了，LED自然就灭了，不会白白消耗电池的电。

如果接到3V3，即使不充电，LED也可能微弱发光（取决于CHRG/STDBY的漏电流），白白浪费电池电量。

#### 还有什么替代方案？

- **用一颗双色LED**（红绿共阳极）：省一个LED的位置，但连线稍复杂
- **不要LED**：CHRG和STDBY引脚接GND（数据手册说如果不用状态指示就接GND）
- **LED接到GPIO**：让ESP32-S3读取充电状态，在屏幕上显示。但这会额外占用2个GPIO

---

### 第9步：放置拨动开关（电源总开关）

#### 操作

1. 搜索并放置 **拨动开关**（搜索 `SS-12D00` 或 `拨动开关`，选 SPDT 单刀双掷 或 SPST 单刀单掷）
2. 连接方式：
   - 开关的一端接 `VBAT`（TP4056的BAT输出 / 电池正极）
   - 开关的另一端接 `VBAT_SW`（新的网络标签，表示"经过开关后的电池电压"）

```text
VBAT (电池+) ──── [SW1 拨动开关] ──── VBAT_SW (去AMS1117)
```

3. 在开关的输出端放置网络标签 `VBAT_SW`

#### 为什么开关放在TP4056和AMS1117之间？

开关放在这个位置有一个好处：**关机的时候TP4056还能正常工作**。

想象一下：你把开关拨到OFF（关机），ESP32-S3等芯片断电了。但如果这时候你插上USB充电呢？因为开关只断开了电池到AMS1117之间的连接，TP4056那边的VCC和BAT引脚都没受影响，所以充电功能不受影响——**关机状态下也能充电！**

如果把开关放在USB和TP4056之间，关机就不能充电了，这不是我们想要的。

#### 还有什么替代方案？

- **开关放在AMS1117输出端**：也可以，但3.3V输出的电流比较大（整个系统的电流），开关触点需要承受更大电流，触点电阻的压降可能影响供电稳定性。放在电池端更好——虽然电流也大，但电压有余量（3.7V经过AMS1117降到3.3V，中间有0.4V余量给开关触点电阻）
- **不要物理开关**：用一个MOSFET做电子开关，通过ESP32-S3的GPIO控制。但这有个"鸡生蛋蛋生鸡"的问题：ESP32-S3没电的时候怎么控制开关？需要额外的低功耗控制芯片，太复杂了
- **按键开关**（自锁按键）：按下开机，再按关机。效果类似拨动开关，但手感不同

---

### 第10步：放置AMS1117-3.3稳压芯片

#### 操作

1. 在元件库搜索 `C6186` 或 `AMS1117-3.3`
2. 选择 **SOT-223** 封装的版本（3个引脚+1个散热焊盘）
3. 放置在画布 TP4056 的**右边**

#### 认识AMS1117-3.3的3个引脚

| 引脚号 | 引脚名 | 功能 | 怎么接 |
|--------|--------|------|--------|
| 1 | **GND** | 地（固定输出版本）。在可调版本里这个引脚叫ADJ（调节），但我们用的是3.3V固定版本，内部已经接好了分压电阻，这个引脚直接是GND | 接**GND** |
| 2 | **VOUT** | 3.3V输出。芯片内部的调节电路把输入电压降到稳定的3.3V从这里输出 | 接**3V3**（给所有芯片供电） |
| 3 | **VIN** | 输入电压。需要比输出高至少1.2V（这叫"压差"，drop-out voltage），所以最低需要3.3+1.2=4.5V。我们的电池电压3.7~4.2V其实有时候会低于4.5V，但实际测试在小电流下工作还行（后面会讨论） | 接**VBAT_SW**（经过开关后的电池电压） |

> **关于AMS1117的散热焊盘**：SOT-223封装的背面有一个大焊盘（引脚2/VOUT的延伸），PCB布局时需要把它焊到大面积铜皮上帮助散热。在原理图里不需要特别处理。

---

### 第11步：连接AMS1117的VIN引脚

#### 操作

1. 在AMS1117的 **VIN（引脚3）** 旁边，放置网络标签 `VBAT_SW`
2. 在VIN引脚附近放置 **电容C3（10µF）**
   - 一端接 `VBAT_SW`，另一端接 `GND`

```text
VBAT_SW ──┬──── VIN (引脚3, AMS1117)
           │
         C3 (10µF)
           │
          GND
```

#### 为什么要加C3？

和TP4056的输入电容C1是一样的道理——当AMS1117突然需要大电流（比如ESP32-S3突然启动WiFi发射），C3在旁边立刻补上。

数据手册说 AMS1117 输入端需要 ≥10µF 电容，否则可能自激振荡（就是输出电压会像弹簧一样上下跳，非常危险）。

---

### 第12步：连接AMS1117的VOUT引脚

#### 操作

1. 在AMS1117的 **VOUT（引脚2）** 旁边，放置网络标签 `3V3`
   - 这个 `3V3` 标签和ESP32-S3最小系统里用的是同一个标签名，放好后两边就自动"连上"了
2. 在VOUT引脚附近放置 **电容C4（22µF）**
   - 一端接 `3V3`，另一端接 `GND`

```text
VOUT (引脚2, AMS1117) ──┬──── 3V3 (→ 供电给所有芯片)
                         │
                       C4 (22µF)
                         │
                        GND
```

#### 为什么C4要用22µF，比C1/C2/C3都大？

AMS1117的数据手册明确要求：**输出端必须接≥22µF的电容**，否则芯片不稳定。

这是因为AMS1117是LDO（低压差线性稳压器），它的内部反馈回路需要输出电容来帮助稳定。如果输出电容太小或者没有，输出电压会像心电图一样上下波动（这叫"自激振荡"），不仅不能供电，还可能损坏后面的芯片。

22µF是数据手册的最低要求。用更大的电容（比如47µF、100µF）也可以，输出会更平稳，但体积会更大。

> **注意电容类型**：数据手册推荐用 **钽电容**（tantalum capacitor），因为钽电容的ESR（等效串联电阻）比较高（约0.5~5Ω），正好是AMS1117所需的阻尼参数范围。但陶瓷电容（MLCC）的ESR很低（约0.01Ω），在某些条件下可能导致不稳定。
>
> **实际建议**：现在很多AMS1117的改进版本对陶瓷电容已经兼容了。我们用 **22µF 陶瓷电容**（0805封装）是可以的。如果你担心稳定性，可以串联一个0.5Ω的小电阻来人为增加ESR，但通常不需要。

---

### 第13步：连接AMS1117的GND引脚

#### 操作

1. 在AMS1117的 **GND（引脚1）** 放置一个 `GND` 电源符号

```text
GND (引脚1, AMS1117) ──── GND
```

---

### 第14步：关于AMS1117的压差问题

这里需要特别说明一个问题。

AMS1117-3.3的输出是3.3V，但它需要**输入电压比输出至少高1.2V**才能正常工作（1A满载时）。也就是说，VIN至少要 3.3 + 1.2 = **4.5V**。

但我们的锂电池电压范围是 **3.0V（完全没电）~4.2V（充满）**。当电池电压降到4.5V以下时，AMS1117理论上就无法维持3.3V输出了。

**实际情况**：
- 电池充满时（4.2V），AMS1117的实际压差大约只有0.5V左右（因为我们的系统电流远不到1A），所以 4.2 - 0.5 = 3.7V > 3.3V，没问题
- 电池下降到3.8V时，输出可能开始不足3.3V（比如只有3.2V），ESP32-S3可能开始不稳定
- 电池下降到3.5V以下时，基本无法正常供电了

**结论**：AMS1117在电池电压3.8V以上时工作正常，电池大约还有30%~40%电量时就该充电了。对于桌面AI助手这个场景是可以接受的。

> **如果你将来想要更好的解决方案**：可以换用更低压差的LDO芯片，比如：
> - **ME6211C33**：压差仅0.1V@500mA，3.4V输入就能输出稳定3.3V
> - **RT9013-33**：压差0.25V@500mA，嘉立创也有货
> - **AP2112K-3.3**：压差0.4V@600mA，很常见
>
> 这些芯片都是"pin-to-pin"不兼容AMS1117的，需要重新画原理图。但用法基本一样（VIN、VOUT、GND三个引脚）。如果你以后想升级，告诉我，我可以帮你画。

---

## 完整电路示意图

画完所有步骤后，完整电路应该长这样：

```text
                            TP4056 (U1)
                      ┌─────────────────────┐
                      │                     │
    5VUSB ─────┬───────┤ VCC(4)     BAT(5)  ├───┬──── VBAT
              │       │                     │   │
            C1(10µF)  │ CE(8) ───── 5VUSB    │ C2(10µF)
              │       │                     │   │
             GND      │ TEMP(1) ──── GND    │  GND
                      │                     │
                      │ PROG(2)             │
                      │   │                 │
                      │ R1(1.2KΩ)           │
                      │   │                 │
                      │  GND                │
                      │                     │
                      │ CHRG(7) ──── LED1(红) ──── R2(1KΩ) ──── 5VUSB
                      │                     │
                      │ STDBY(6) ─── LED2(绿) ──── R3(1KΩ) ──── 5VUSB
                      │                     │
                      │ GND(3) ───── GND    │
                      └─────────────────────┘


    VBAT ──── BAT1(+) ──→ 锂电池(+)
               BAT1(-) ──→ 锂电池(-) ──→ GND


    VBAT ──── [SW1 拨动开关] ──── VBAT_SW


                            AMS1117-3.3 (U2)
                      ┌─────────────────────┐
                      │                     │
  VBAT_SW ──┬─────────┤ VIN(3)    VOUT(2)  ├───┬──── 3V3 (→所有芯片)
            │         │                     │   │
          C3(10µF)    │ GND(1) ──── GND     │ C4(22µF)
            │         │                     │   │
           GND        └─────────────────────┘  GND
```

---

## 网络标签总结

| 网络标签名 | 含义 | 连接到哪里 |
|-----------|------|-----------|
| `5VUSB` | USB 5V电源 | 来自Type-C接口（01_ESP32-S3最小系统中已定义）→ TP4056的VCC、CE、LED电阻 |
| `VBAT` | 电池电压（3.0~4.2V） | TP4056的BAT ↔ 电池正极 ↔ 开关输入 |
| `VBAT_SW` | 开关后的电池电压 | 开关输出 → AMS1117的VIN |
| `3V3` | 稳定3.3V电源 | AMS1117的VOUT → ESP32-S3及所有芯片（01_ESP32-S3最小系统中已定义） |
| `GND` | 地（公共参考零电位） | 所有芯片和元件的GND |

> 注意：`5VUSB` 和 `3V3` 这两个网络标签在 `01_ESP32-S3最小系统.md` 中已经使用过了。你在电源管理电路中放置的同名标签会自动和那边连通，不需要额外拉线。

---

## 检查清单

画完后，逐项确认以下内容：

### 连接检查

- [ ] TP4056的VCC（引脚4）连到了 `5VUSB`
- [ ] TP4056的BAT（引脚5）连到了 `VBAT`
- [ ] TP4056的GND（引脚3）连到了 `GND`
- [ ] TP4056的TEMP（引脚1）连到了 `GND`
- [ ] TP4056的PROG（引脚2）通过1.2KΩ电阻连到了 `GND`
- [ ] TP4056的CE（引脚8）连到了 `5VUSB`
- [ ] TP4056的CHRG（引脚7）通过LED和电阻连到了 `5VUSB`
- [ ] TP4056的STDBY（引脚6）通过LED和电阻连到了 `5VUSB`
- [ ] AMS1117的VIN（引脚3）连到了 `VBAT_SW`
- [ ] AMS1117的VOUT（引脚2）连到了 `3V3`
- [ ] AMS1117的GND（引脚1）连到了 `GND`
- [ ] 拨动开关连接在 `VBAT` 和 `VBAT_SW` 之间
- [ ] 电池接口的正极连到 `VBAT`，负极连到 `GND`

### 元件值检查

- [ ] R1 = 1.2KΩ，1%精度（充电电流约1000mA）
- [ ] R2 = R3 = 1KΩ（LED限流）
- [ ] C1 = C2 = C3 = 10µF（去耦电容）
- [ ] C4 = 22µF（AMS1117输出稳定电容，**必须≥22µF**）
- [ ] LED1 = 红色，LED2 = 绿色

### 网络标签检查

- [ ] `5VUSB` 拼写一致（和ESP32-S3最小系统那边一样）
- [ ] `3V3` 拼写一致（和ESP32-S3最小系统那边一样）
- [ ] `VBAT` 在TP4056的BAT端和电池接口正极都有
- [ ] `VBAT_SW` 在开关输出端和AMS1117的VIN端都有

### ERC检查

- [ ] 运行嘉立创EDA的 **"设计" → "电气规则检查"**（ERC）
- [ ] 确认没有红色错误（黄色警告通常是"引脚未连接"，确认是故意的就行）

---

## 常见问题

### Q1：我可以不用电池，直接用USB 5V供电吗？

可以，但需要修改电路。最简单的方式是：不放TP4056和电池，直接把5VUSB接到AMS1117的VIN。这样就是"插USB才能用、拔掉就关机"的模式。缺点是不能移动使用。

### Q2：充电的时候可以同时使用设备吗？

可以。TP4056会给电池充电，同时电池通过AMS1117给系统供电。但要注意：TP4056的充电电流上限是约1000mA（我们设定的），如果系统同时消耗的电流比较大（比如200mA），实际进入电池的充电电流会减少，充电时间会变长。我们用的1200mAh电池，纯充电约1.2小时充满，边用边充大约1.5~2小时。

### Q3：电池会过放吗？会不会充爆？

- **过充保护**：TP4056内部有精确的4.2V恒压控制，充到4.2V会自动切到恒压模式，然后电流逐渐减小，最终停止充电。不会过充
- **过放保护**：TP4056**没有**过放保护功能。如果你的电池放电到3.0V以下甚至0V，可能永久损坏。建议买带保护板的锂电池（大多数锂电池出厂都自带保护板，会在2.5~3.0V自动切断输出）
- **短路保护**：TP4056有内部短路保护（BAT Short-Circuit Duration: Continuous），但这只保护充电端，不保护电池到AMS1117之间。如果你不小心短路了VBAT和GND，电池会直接大电流放电，可能起火。所以**一定要小心操作**

### Q4：AMS1117发热很大怎么办？

AMS1117是线性稳压器（LDO），多余的电压以热量的形式散掉。发热功率 = (VIN - VOUT) × 电流 = (3.7 - 3.3) × 0.3A ≈ 0.12W。这个发热量很小，正常使用不会烫手。

但如果你用USB直供5V不加电池（VIN=5V），发热 = (5 - 3.3) × 0.3 = 0.51W，SOT-223封装摸着会有点温热，但还在安全范围内。

如果ESP32-S3全力运行WiFi+蓝牙+屏幕（电流可能到500mA），发热 = (5 - 3.3) × 0.5 = 0.85W，需要PCB上多留散热铜皮。

### Q5：LED不亮怎么回事？

几种可能：
1. **USB没插**：LED接的是5VUSB，没插USB就没电
2. **LED接反了**：LED有方向性，阳极（+，通常引脚较长）要靠近电阻那边，阴极（-）靠近CHRG/STDBY引脚
3. **电池没接**：TP4056检测不到电池的时候，CHRG引脚会输出PWM信号（LED闪烁），如果闪得太快肉眼可能看不出来
4. **限流电阻值太大**：如果误用了10KΩ而不是1KΩ，电流只有0.3mA，LED可能暗到看不见

### Q6：我买的TP4056是模块板（蓝色小板），可以直接用吗？

可以。TP4056模块板上已经焊好了TP4056芯片、电容、电阻、LED，甚至还有USB Micro接口。但有几个注意事项：
- 模块板通常不是Type-C接口，需要另外连线
- 模块板上的充电电流电阻通常是1.2KΩ（约1A充电），你可以看板上标注确认
- 如果用模块板，你的PCB就不需要画TP4056部分了，直接从模块板的BAT+/BAT-引出线接到你的AMS1117就行
- 但最终产品建议还是自己画PCB，更紧凑可靠

---

## 下一步

电源管理电路画完后，你的AI-Bot的核心电路就只差以下模块了：

- [ ] 六轴传感器（MPU6050/QMI8658）
- [ ] 触摸按键（TTP223 + 物理按键）

准备好了就告诉我要画哪个模块！
