# INMP441 麦克风原理图设计教程（嘉立创EDA）

> INMP441是一颗数字MEMS麦克风，通过I2S接口直接输出数字音频信号给ESP32-S3，不需要额外的音频编解码芯片。
> 简单说：它就是一个"数字耳朵"，听到声音后直接把声音变成数字信号发给主控。

---

## 第一步：认识INMP441

### 它是什么？

INMP441 是一颗非常小的麦克风芯片（4.72 × 3.76 × 1mm），底部有个小孔用来收音。它内部集成了：

- MEMS传感器（把声波转成电信号的微机械结构）
- ADC（模数转换器，把模拟电信号变成数字信号）
- 滤波器（过滤掉不需要的噪声）
- I2S接口（标准的数字音频传输协议）

你只需要给它供电、接上时钟线和数据线，它就能直接输出24位的高精度数字音频。

### 为什么选INMP441而不是其他麦克风？

| 对比 | INMP441（数字I2S） | MAX4466等模拟麦克风 |
|------|-------------------|-------------------|
| 输出信号 | 数字（I2S协议） | 模拟（电压变化） |
| 需要ADC？ | 不需要，自带 | 需要，ESP32-S3的ADC精度只有12位 |
| 音质 | 24位高精度，信噪比61dBA | 受ADC精度限制，噪声较大 |
| 抗干扰 | 强（数字信号不容易被干扰） | 弱（模拟信号容易被电源、射频干扰） |
| 接线 | 3根信号线（SCK/WS/SD） | 1根信号线，但需要额外的放大电路 |

结论：数字麦克风在音质和抗干扰方面完胜，而且接线更简单，非常适合和ESP32-S3配合使用。

---

## 第二步：认识INMP441的引脚

INMP441一共有9个引脚：

| 引脚号 | 名称 | 功能 | 你需要做什么 |
|--------|------|------|-------------|
| 1 | **SCK** | I2S时钟线（主控提供节拍） | 接ESP32-S3的IO14 |
| 2 | **SD** | I2S数据输出（麦克风的声音数据从这里出来） | 接ESP32-S3的IO16，加100K下拉电阻 |
| 3 | **WS** | I2S帧同步（区分左/右声道） | 接ESP32-S3的IO15 |
| 4 | **L/R** | 左/右声道选择 | 接GND（选左声道） |
| 5 | **GND** | 地 | 接GND |
| 6 | **GND** | 地 | 接GND |
| 7 | **VDD** | 电源（1.8V~3.3V） | 接3V3，加100nF去耦电容 |
| 8 | **CHIPEN** | 芯片使能（开关） | 接3V3（常开） |
| 9 | **GND** | 地 | 接GND |

---

## 第三步：你需要准备的元件

| 元件 | 值/型号 | 封装 | 数量 | 用途 |
|------|--------|------|------|------|
| INMP441 麦克风 U2 | INMP441 | LGA-9 | 1 | 数字MEMS麦克风 |
| 去耦电容 C5 | 100nF | 0603 | 1 | VDD电源滤波 |
| 下拉电阻 R5 | 100K | 0603 | 1 | SD数据线下拉 |

没错，就这么少——INMP441本身已经把大部分电路都集成在芯片内部了，外围只需要一个电容和一个电阻。

---

## 第四步：在嘉立创EDA中放置元件

### 4.1 放置INMP441

1. 点击右侧 **"元件库"**（或快捷键 `Shift+F`）
2. 搜索 `INMP441`
3. 选择嘉立创自营库中的元件（带蓝色"嘉"标志的优先）
4. 点击 **"放置"**，在画布上点一下

> **小提示**：如果搜不到，试试搜商城编号。或者直接搜 `INMP441ACEZ` （完整型号）。

### 4.2 放置100nF电容（C5）

1. 搜索 `100nF`，选择 `0603` 封装
2. 放在INMP441旁边（靠近VDD引脚的位置）

### 4.3 放置100K电阻（R5）

1. 搜索 `100K`，选择 `0603` 封装
2. 放在INMP441旁边（靠近SD引脚的位置）

---

## 第五步：连线

### 连接示意图

```text
                        INMP441 (U2)
                    ┌──────────────────┐
                    │                  │
  I2S_MIC_SCK ─────│ SCK (Pin 1)      │
                    │                  │
  I2S_MIC_SD ──┬───│ SD  (Pin 2)      │
               │   │                  │
             R5(100K)│                  │
               │   │ WS  (Pin 3)      │──── I2S_MIC_WS
              GND  │                  │
                    │ L/R (Pin 4)      │──── GND
                    │                  │
                    │ GND (Pin 5)      │──── GND
                    │                  │
                    │ GND (Pin 6)      │──┬── GND
                    │                  │  │
               3V3──│ VDD (Pin 7)      │  │
                │   │                  │  │
              C5(100nF)                │  │
                │   │ CHIPEN (Pin 8)   │──── 3V3
               GND  │                  │
                    │ GND (Pin 9)      │──── GND
                    │                  │
                    └──────────────────┘
```

### 操作步骤

**1. 连接I2S信号线（用网络标签）**

在INMP441的对应引脚上放置网络标签：

| 引脚 | 网络标签 | 说明 |
|------|---------|------|
| SCK (Pin 1) | `I2S_MIC_SCK` | 和ESP32-S3的IO14同名，自动连接 |
| SD (Pin 2) | `I2S_MIC_SD` | 和ESP32-S3的IO16同名，自动连接 |
| WS (Pin 3) | `I2S_MIC_WS` | 和ESP32-S3的IO15同名，自动连接 |

> 这些标签名必须和你在ESP32-S3模组上放的标签**完全一致**（包括大小写），否则EDA不认为它们是连在一起的。

**2. 连接L/R引脚**

用导线把 L/R (Pin 4) 连到 GND 符号。

**3. 连接电源**

- VDD (Pin 7) 连到 `3V3` 电源符号
- CHIPEN (Pin 8) 也连到 `3V3` 电源符号
- 所有GND引脚 (Pin 5, 6, 9) 连到 `GND` 符号

**4. 放置去耦电容C5**

- C5 一端连到 VDD (Pin 7) 的线上
- C5 另一端连到 GND
- **尽量靠近Pin 7放置**

**5. 放置下拉电阻R5**

- R5 一端连到 SD (Pin 2) 的线上
- R5 另一端连到 GND

---

## 第六步：每个连接的详细解释

### SCK（时钟线）— 为什么需要？

I2S通信需要一个"节拍器"来同步数据传输。SCK就是这个节拍器，由ESP32-S3（主设备）产生，INMP441（从设备）按照这个节拍输出数据。

频率要求：SCK = 64 × WS采样率。比如采样率48kHz时，SCK = 64 × 48000 = 3.072MHz。数据手册规定SCK范围是0.5~3.2MHz，所以48kHz采样率刚好在范围内。如果你用16kHz采样率，SCK = 1.024MHz，也完全没问题。

> **采样率怎么选？** 语音识别一般用16kHz就够了（电话级质量），音乐级可以用48kHz。我们的项目是语音交互，16kHz足够。采样率在ESP32-S3的代码里设置，不需要在硬件上改任何东西。

### WS（帧同步/字选择）— 为什么需要？

WS = Word Select，用来告诉麦克风"现在该输出左声道数据还是右声道数据"。

- WS = LOW → 左声道时间段
- WS = HIGH → 右声道时间段

即使我们只有一个麦克风，WS信号也是必须的——I2S协议就是这么定义的，少了这根线通信就不成立。

WS的频率就是采样率（比如48kHz），ESP32-S3会自动生成。

### SD（数据线）— 为什么需要下拉电阻？

SD是麦克风输出音频数据的线。INMP441是24位输出，每个I2S帧有64个时钟周期，其中左声道占前32个，右声道占后32个。

INMP441在不属于自己的那半个帧期间，会把SD引脚设为**高阻态（tri-state）**——就是"我不说话了，你们随便"。

问题来了：高阻态时，SD线上没有任何东西在驱动它，它就"浮"着，可能被干扰拉高拉低，产生噪声。

**100K下拉电阻的作用**：在高阻态期间，把SD线温柔地拉到GND（低电平），保持线上干净。

为什么是100K？
- 太小（比如1K）：当麦克风正在输出数据时，电阻会和输出驱动"打架"，分走电流，影响信号质量
- 太大（比如10M）：拉的力量太弱，噪声依然存在
- 100K是折中：不影响正常数据输出，又能在高阻态时把线拉干净

> **如果只有一个麦克风，不加这个电阻行不行？** 严格来说也能工作，因为单声道时高阻态期间ESP32-S3可以忽略那段数据。但加了更稳妥，而且100K电阻几乎不花钱。数据手册明确推荐加，我们就加上。

> **如果以后想加第二个麦克风做立体声怎么办？** 两颗INMP441共享同一组SCK/WS/SD线，一颗L/R接GND（左声道），另一颗L/R接VDD（右声道）。它们轮流在各自的半帧期间输出数据，SD线只需要一根，100K下拉电阻也只需要一个。

### L/R（声道选择）— 为什么接GND？

L/R引脚决定这颗麦克风在I2S帧里的哪个时间段输出数据：

| L/R电平 | 输出声道 | WS对应关系 |
|---------|---------|-----------|
| LOW (GND) | 左声道 | WS=LOW时输出 |
| HIGH (VDD) | 右声道 | WS=HIGH时输出 |

我们只有一颗麦克风，接GND选左声道是最常见的做法。在代码里读取左声道数据即可。

> **接VDD（右声道）行不行？** 完全可以，只要代码里对应读右声道数据就行。没有本质区别，只是习惯上单麦克风用左声道。

> **L/R能不能浮空不接？** 不行！浮空的话电平不确定，麦克风可能左右声道随机切换，导致数据混乱。**必须明确接GND或VDD。**

### VDD（电源）— 为什么加100nF去耦电容？

INMP441支持1.8V~3.3V供电，我们的系统是3.3V，直接用3V3供电。

在3.3V下，INMP441的典型工作电流是2.2mA，非常省电。

**100nF去耦电容的作用**和ESP32-S3那里一样——过滤电源上的高频噪声。数据手册原话："placing a 0.1µF ceramic type X7R or better capacitor between Pin 7 (VDD) and ground is strongly recommended"（强烈推荐在VDD和GND之间放一颗0.1µF陶瓷电容）。

数据手册还特别强调：电容要尽量靠近Pin 7放，走线越短越好，不要跨层打过孔。因为麦克风对电源噪声很敏感——电源不干净，录出来的声音就有底噪。

> **需要加10uF大电容吗？** 对于INMP441，100nF就够了。它的工作电流很小（2.2mA），不会像ESP32-S3那样有大电流波动。一颗100nF足以应对。

> **用什么类型的电容？** 数据手册推荐X7R或更好的陶瓷电容。X7R的温度稳定性好，容值随温度变化小。嘉立创商城的0603 100nF电容默认就是X7R或X5R的，选便宜的就行。

### CHIPEN（芯片使能）— 为什么接VDD？

CHIPEN = Chip Enable，是麦克风的"开关"：

| CHIPEN电平 | 状态 | 说明 |
|-----------|------|------|
| HIGH (VDD) | 使能/正常工作 | 麦克风运行，输出音频数据 |
| LOW (GND) | 关闭/省电模式 | 麦克风关闭，电流降到几微安 |

我们把它直接接到3V3，让麦克风一直工作。

> **另一种做法**：如果你想在不需要录音时关闭麦克风省电，可以把CHIPEN接到ESP32-S3的一个空闲GPIO上（比如IO4或IO5）。代码里：录音时把GPIO拉高开启麦克风，不录时拉低关闭。
>
> 但要注意：从关闭到重新启动需要大约43ms（2^17个时钟周期），这段时间麦克风没有输出。如果你的应用需要"随时随地立即录音"，直接接VDD让它一直开着更好。
>
> 对于我们的项目，2.2mA的功耗完全可以接受，不需要频繁开关，所以直接接VDD最简单。

### GND（地）— 为什么要全部接？

INMP441有3个GND引脚（Pin 5, 6, 9），和ESP32-S3一样的道理——全部接地才能保证良好的接地参考。数据手册特别指出Pin 6（VDD旁边的GND）应该作为去耦电容的地端，这样电容的回路最短。

---

## 第七步：检查清单

画完后，逐项确认：

- [ ] INMP441已放置
- [ ] SCK (Pin 1) 标签 `I2S_MIC_SCK` — 和ESP32-S3的IO14同名
- [ ] SD (Pin 2) 标签 `I2S_MIC_SD` — 和ESP32-S3的IO16同名
- [ ] WS (Pin 3) 标签 `I2S_MIC_WS` — 和ESP32-S3的IO15同名
- [ ] L/R (Pin 4) 接GND
- [ ] GND (Pin 5, 6, 9) 全部接GND
- [ ] VDD (Pin 7) 接3V3
- [ ] C5 (100nF) 接在VDD和GND之间，紧靠Pin 7
- [ ] CHIPEN (Pin 8) 接3V3
- [ ] R5 (100K) 接在SD线和GND之间
- [ ] 所有网络标签拼写与ESP32-S3上的完全一致

---

## 第八步：画完后你应该有这些元件

| 类别 | 元件 | 位号 | 值/型号 | 数量 |
|------|------|------|--------|------|
| 核心 | MEMS麦克风 | U2 | INMP441 | 1 |
| 电源 | 去耦电容 | C5 | 100nF / 0603 | 1 |
| 信号 | 下拉电阻 | R5 | 100K / 0603 | 1 |

**总计：1个麦克风 + 1个电容 + 1个电阻 + 3个网络标签**

---

## 常见问题

**Q: INMP441模块和INMP441裸芯片有什么区别？**

如果你在淘宝搜INMP441，会看到很多"INMP441麦克风模块"（一块小板子上面焊好了INMP441和电容电阻）。那是给面包板调试用的。

我们在做PCB设计，直接用**裸芯片INMP441**焊在自己的板子上。这样体积更小、成本更低、布局更灵活。前面画的原理图就是裸芯片方案。

**Q: 录音有底噪/电流声怎么办？**

原因通常是：
1. **去耦电容离芯片太远**（PCB布局时要注意，100nF电容要紧挨着INMP441的VDD和GND引脚）
2. **麦克风离WiFi天线太近**（ESP32-S3发射WiFi时会产生电磁干扰，PCB布局时麦克风要远离天线区域）
3. **数字信号线（I2S）和模拟电源线太近**（PCB布局时尽量分开走）
4. **地平面不完整**（PCB铺铜时要保证麦克风下方有完整的地平面）

这些都是PCB布局阶段要考虑的，原理图阶段先不用担心，但先记着。

**Q: 我能用3.3V也能用1.8V供电，选哪个？**

用3.3V。原因：
1. 我们系统的电源就是3.3V，不需要额外弄一个1.8V电源
2. 3.3V下输出信号幅度更大，和ESP32-S3的IO电平匹配（ESP32-S3的IO也是3.3V电平）
3. 虽然3.3V下功耗稍大（2.2mA vs 1.4mA），但差别极小

**Q: SCK/WS/SD这三根线需要加电阻或电容吗？**

不需要。这三根数字信号线直接连就行。只有SD线需要一个100K下拉电阻（前面已经加了）。数据手册的典型应用电路里，这三根线都是直连的。

---

## 下一步

INMP441麦克风电路画好后，建议接下来画 **MAX98357A 功放电路**（音频输出），这样输入输出都有了，可以做"回声测试"——对着麦克风说话，扬声器立刻播放出来。

准备好了就告诉我。
