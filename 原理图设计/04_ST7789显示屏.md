# ST7789 显示屏接口原理图设计教程（嘉立创EDA）

> ST7789是一颗TFT液晶显示驱动芯片，我们用的1.54寸IPS裸屏（型号T154H7-C12-01）内部就集成了这颗芯片。ESP32-S3通过SPI接口把要显示的内容（像素数据）发给它，它就在屏幕上画出来。
> 简单说：它就是一个"数字眼睛"，收到图像数据后在屏幕上显示出来。

---

## 第一步：认识这块1.54寸屏幕

### 它是什么？

ST7789 是一颗TFT液晶屏驱动芯片，由Sitronix（矽创电子）生产。它内部集成了：

- 帧缓冲存储器（Frame Memory，存储要显示的图像数据）
- 显示驱动电路（把数据变成液晶屏能识别的驱动信号）
- DC/DC升压电路（液晶屏需要多种电压，芯片内部自动产生）
- SPI/并行接口（和主控通信的接口）

### 裸屏 vs 模组——我们用的是哪种？

市面上常见两种形态：

| 对比 | 裸屏（我们用的） | 模组（带小PCB板的） |
|------|----------------|-------------------|
| 外观 | 一块玻璃面板 + FPC排线 | 玻璃面板 + 小PCB板 + 排针 |
| 连接方式 | FPC排线插到FPC连接器 | 排针直接插排母 |
| 内部集成 | ST7789芯片（贴在玻璃上）+ 背光LED | 和裸屏一样，但PCB上额外加了限流电阻等 |
| 你需要做的 | 需要自己加背光限流电阻 + FPC连接器 | 只需排针/排母，几乎不用加东西 |
| 体积 | 更薄更小，适合做成品产品 | 稍厚，多了一层PCB |
| 价格 | 更便宜 | 稍贵（多了PCB和焊接工序） |

我们选的 **T154H7-C12-01** 是深圳金逸晨电子生产的一块裸屏，ST7789芯片通过COG（Chip On Glass）工艺直接贴在玻璃上。它通过底部的12针FPC排线（**0.5mm间距**）引出所有必要的接口信号。

和带PCB板的模组相比，裸屏的区别就是：**背光LED的限流电阻需要你自己在PCB上加**（模组的小PCB板上已经帮你焊好了）。其他SPI信号接法完全一样。

> **好消息**：虽然是裸屏，但ST7789内部的DC/DC升压电路会自动产生液晶屏需要的各种驱动电压（VGH、VGL、AVDD等），这些电压的去耦电容也已经在屏幕的FPC柔性电路上集成了。你不需要在自己的PCB上设计升压电路。

### 这块屏幕的参数

| 参数 | 值 |
|------|-----|
| 型号 | T154H7-C12-01 V2 |
| 厂商 | 深圳金逸晨电子 (GoldenMorning) |
| 驱动芯片 | ST7789 |
| 尺寸 | 1.54英寸 |
| 外形尺寸 | 31.42mm × 33.67mm × 2.17mm |
| 显示区域 | 27.72mm × 27.72mm |
| 分辨率 | 240 × 240像素 |
| 显示颜色 | 262K色 |
| 接口 | 4线SPI |
| 工作电压(VDD) | 2.4V~3.3V（典型2.75V） |
| 背光LED | 白色LED，正向电压VF=3.0V（典型），正向电流IF=60mA（典型） |
| 亮度 | 300cd/m²（典型） |
| 对比度 | 700~900:1 |
| 可视角度 | IPS全视角 |
| FPC | 12pin，**0.5mm间距** |
| 工作温度 | -20℃~+70℃ |

### 为什么选SPI接口而不是并行接口？

ST7789支持多种接口：8位/16位并行、RGB接口、SPI接口。

| 对比 | SPI接口 | 8位并行接口 |
|------|---------|-----------|
| 需要的信号线 | 4~5根 | 11根以上 |
| 占用GPIO | 少（5~6个） | 多（12+个） |
| 刷新速度 | 够用（SPI最高可达62.5MHz） | 更快 |
| 接线复杂度 | 简单 | 复杂 |
| 适合场景 | 小尺寸屏、显示不需要60fps | 大屏、视频播放 |

我们的1.54寸屏只显示时间、天气、状态文字等简单内容，SPI接口完全够用。而且ESP32-S3的GPIO本来就不多（N16R8模组可用GPIO有限），用SPI能省下很多引脚给其他功能。

> **62.5MHz从哪来的？** 数据手册的时序表里，SPI写入时钟周期最小16ns，1/16ns = 62.5MHz。ESP32-S3的SPI外设最高80MHz，但屏幕这边最高只能62.5MHz。实际用40MHz就绰绰有余。

---

## 第二步：认识屏幕的FPC引脚

这块屏幕通过底部的12针FPC排线引出信号，**0.5mm间距**：

| FPC引脚 | 名称 | 方向 | 功能 | 你需要做什么 |
|---------|------|------|------|-------------|
| 1 | **GND** | 电源 | 地 | 接GND |
| 2 | **LED-K** | 电源 | 背光LED阴极（负极） | 接GND（简单方案）或接三极管（控制方案） |
| 3 | **LED-A** | 电源 | 背光LED阳极（正极），正向电压3.0V | 通过4.7Ω电阻接3V3 |
| 4 | **VDD** | 电源 | 芯片电源（2.4V~3.3V） | 接3V3，加100nF去耦电容 |
| 5 | **GND** | 电源 | 地 | 接GND |
| 6 | **GND** | 电源 | 地 | 接GND |
| 7 | **DCX** | 输入 | 数据/命令选择 | 接ESP32-S3的IO10 |
| 8 | **CSX** | 输入 | 片选（低电平选中） | 接ESP32-S3的IO9 |
| 9 | **SCL** | 输入 | SPI时钟线 | 接ESP32-S3的IO12 |
| 10 | **SDA** | 输入 | SPI数据线（MOSI） | 接ESP32-S3的IO11 |
| 11 | **RESX** | 输入 | 复位（低电平复位） | 接ESP32-S3的IO46 |
| 12 | **GND** | 电源 | 地 | 接GND |

> **引脚名称对照**：这块屏幕的数据手册用的是DCX/CSX/RESX这些名称（X表示低电平有效），和其他资料里常见的DC/CS/RESET是同一个东西。我们在网络标签里统一用 `LCD_DC`、`LCD_CS`、`LCD_RST`，和ESP32-S3端保持一致。

> **和带PCB模组的区别**：模组通常只有7~8个引脚（GND、VCC、SCL、SDA、RES、DC、CS、BLK），因为模组的小PCB板把背光限流电阻和多余的GND都处理好了，还把LED-A和LED-K合并成一个BLK引脚。而裸屏直接把12个原始引脚全部引出来了。

### LED-A和LED-K是什么？和模组的BLK有什么关系？

液晶屏本身不发光（和OLED不同），需要背后的白色LED来照亮。这块裸屏把背光LED的两个极分别引出来了：

- **LED-A** = LED Anode = LED阳极（正极）
- **LED-K** = LED Cathode = LED阴极（负极）

带PCB的模组通常在板上焊好了限流电阻，然后把控制信号合并成一个`BLK`引脚——你给BLK高电平就亮，低电平就灭。

裸屏没有这层处理，所以你需要**自己加限流电阻**。这是裸屏和模组在电路设计上唯一的区别。

---

## 第三步：理解SPI协议（和I2S的区别）

前面的麦克风和功放用的是I2S协议（专门传音频数据），屏幕用的是SPI协议（通用的高速串行数据传输协议）。

### SPI的4根核心线

| 信号线 | 全称 | 作用 | 类比 |
|--------|------|------|------|
| **SCK/SCL** | Serial Clock | 时钟线，主控产生节拍 | 和I2S的BCLK类似 |
| **MOSI/SDA** | Master Out Slave In | 主控发数据给屏幕 | 和I2S的DIN类似（方向相反于MIC的SD） |
| **CS/CSX** | Chip Select | 片选，拉低表示"我在和你说话" | I2S没有这个概念 |
| **DC/DCX** | Data/Command | ST7789特有：区分"命令"还是"数据" | I2S的WS区分左右声道，这个区分命令和数据 |

### SPI vs I2S 对比

| 对比 | SPI（屏幕用） | I2S（音频用） |
|------|-------------|-------------|
| 用途 | 通用数据传输 | 专门传音频 |
| 信号线 | SCK + MOSI + CS + (DC) | BCLK + LRCLK + DIN/SD |
| 速度 | 可以非常快（ESP32-S3 SPI最高80MHz） | 固定于采样率×位深（通常几MHz） |
| 数据含义 | 可以是任何数据（像素、命令...） | 只有音频采样数据 |
| 片选 | 有CS引脚，可以多设备共享总线 | 无片选，通过L/R引脚区分声道 |

### DCX引脚是ST7789特有的

SPI协议本身只有SCK/MOSI/MISO/CS四根线，但ST7789多了一根DCX线（有些资料叫D/C、A0或RS）。

为什么需要DCX？因为你发给屏幕的数据有两种：
- **命令**（Command）：告诉屏幕"接下来要做什么"，比如"设置显示区域"、"开始写入像素数据"、"旋转屏幕方向"
- **数据/参数**（Data）：实际的像素颜色值，或者命令的参数

DCX线就是用来区分这两种的：
- DCX = LOW（0）→ 当前发送的是**命令**
- DCX = HIGH（1）→ 当前发送的是**数据**

> 如果没有DCX线怎么办？那就只能用3线SPI（把D/CX信息编码到数据帧里），每个字节要传9位而不是8位，效率低而且代码写起来更复杂。所以4线SPI（带DCX引脚）是最常用的方式。

---

## 第四步：你需要准备的元件

### 必须的元件（背光常亮方案）

| 元件 | 值/型号 | 封装 | 数量 | 位号 | 用途 |
|------|--------|------|------|------|------|
| FPC连接器 | 12P 0.5mm间距 翻盖式 | - | 1 | J3 | 连接屏幕FPC排线 |
| 去耦电容 | 100nF | 0603 | 1 | C8 | VDD电源滤波 |
| 限流电阻 | 4.7Ω | 0603 | 1 | R6 | 背光LED限流 |

### 可选元件（背光GPIO控制方案）

如果你想通过代码控制背光开关和亮度，额外需要：

| 元件 | 值/型号 | 封装 | 数量 | 位号 | 用途 |
|------|--------|------|------|------|------|
| NPN三极管 | S8050 | SOT-23 | 1 | Q1 | 背光开关控制 |
| 基极电阻 | 2.2K | 0603 | 1 | R7 | 三极管基极限流 |
| 基极下拉电阻 | 10K | 0603 | 1 | R8 | 三极管默认关断 |

> **为什么裸屏比模组多了R6？** 因为模组的小PCB板上已经焊好了背光限流电阻。裸屏直接把LED阳极和阴极引出来了，你必须自己加限流电阻，否则LED会因为过电流烧掉。

> **4.7Ω怎么算出来的？** 屏幕数据手册标注背光LED正向电压VF=3.0V（典型），正向电流IF=60mA（典型）。用3.3V供电时：电流 = (3.3V - 3.0V) / 4.7Ω ≈ 64mA。接近数据手册的60mA典型值，处于正常工作范围。如果觉得太亮，可以换成10Ω（电流降到30mA，亮度减半）。

> **为什么不直接用5Ω？** 5Ω不是标准电阻值（电阻有标准E24系列，不是任意值都有卖）。4.7Ω和5.1Ω是最接近5Ω的两个标准值，嘉立创商城都有货。5.1Ω给出的电流是59mA，4.7Ω给出64mA，两个都可以。

> **方案B为什么多了R8（10K下拉电阻）？** 这是屏幕数据手册参考原理图里推荐的设计。R8接在三极管基极和GND之间，确保在ESP32-S3上电前（GPIO还没初始化时）三极管保持关断状态，避免上电瞬间背光闪烁。

---

## 第五步：在嘉立创EDA中放置元件

### 5.1 放置FPC连接器（J3）

1. 点击右侧 **"元件库"**（或快捷键 `Shift+F`）
2. 搜索 `FPC 12P 0.5` 或 `FPC 0.5mm 12`
3. 选择 **12针、0.5mm间距、翻盖式（掀盖式）** 的FPC连接器
4. 注意选择正确的**接触方向**：
   - **下接（Bottom Contact）**：FPC排线的触点朝下插入
   - **上接（Top Contact）**：FPC排线的触点朝上插入
   - 具体选哪种，取决于你的屏幕FPC排线触点在哪一面——看FPC排线末端的金手指（金色触点）在哪面
5. 点击 **"放置"**，在画布上点一下

> **0.5mm间距是最常见的FPC间距**，嘉立创EDA元件库里非常多选择。搜索时如果结果太多，可以加上"12P"或"12Pin"来过滤针数。常见品牌有：
> - 韩国XUNPU（讯普）
> - Cvilux（厦门虹鹭）
> - HRS（广濑）
> - Molex
> - Amphenol
>
> 选便宜的、有货的就行。

> **接触方向怎么确定？** 看你买的屏幕的FPC排线末端。数据手册的机械图里标注了"Contact sides"（触点面），触点面朝下就选下接，朝上就选上接。如果不确定，拿到屏幕实物看一下FPC排线末端的金手指在哪面就知道了。

### 5.2 放置100nF电容（C8）

1. 搜索 `100nF`，选择 `0603` 封装
2. 放在J3旁边（靠近VDD引脚的位置）

### 5.3 放置4.7Ω电阻（R6）

1. 搜索 `4.7R` 或 `4.7Ω`，选择 `0603` 封装
2. 放在J3旁边（靠近LED-A引脚的位置）

### 5.4 （可选）放置三极管Q1和电阻R7、R8

如果你选择GPIO控制背光：

1. 搜索 `S8050`，选择 `SOT-23` 封装的NPN三极管
2. 搜索 `2.2K`，选择 `0603` 封装（R7，基极限流）
3. 搜索 `10K`，选择 `0603` 封装（R8，基极下拉）
4. 放在靠近LED-K引脚的位置

---

## 第六步：连线

### 方案A：背光常亮（推荐新手，最简单）

```text
                          屏幕FPC连接器 J3 (12P 0.5mm)
                       ┌─────────────────────────────┐
                       │                             │
             GND ─────│ Pin 1  (GND)                │
                       │                             │
             GND ─────│ Pin 2  (LED-K)              │
                       │                             │
    3V3 ── R6(4.7Ω) ──│ Pin 3  (LED-A)              │
                       │                             │
    3V3 ──┬───────────│ Pin 4  (VDD)                │
          │           │                             │
       C8(100nF)      │                             │
          │           │                             │
         GND          │                             │
                       │                             │
             GND ─────│ Pin 5  (GND)                │
                       │                             │
             GND ─────│ Pin 6  (GND)                │
                       │                             │
       LCD_DC ────────│ Pin 7  (DCX)                │
                       │                             │
       LCD_CS ────────│ Pin 8  (CSX)                │
                       │                             │
       SPI_SCK ───────│ Pin 9  (SCL)                │
                       │                             │
       SPI_MOSI ──────│ Pin 10 (SDA)                │
                       │                             │
       LCD_RST ───────│ Pin 11 (RESX)               │
                       │                             │
             GND ─────│ Pin 12 (GND)                │
                       │                             │
                       └─────────────────────────────┘
```

### 方案B：背光GPIO控制（可调亮度，可省电）

和方案A的区别仅在于Pin 2 (LED-K) 的接法不同：

```text
背光部分（方案B）— 和数据手册参考原理图一致：

    3V3 ── R6(4.7Ω) ── Pin 3 (LED-A)
                         │
                      [背光LED]
                         │
                        Pin 2 (LED-K)
                         │
                      Q1 集电极(C)
                         │
                      Q1 发射极(E) ── GND

    LCD_BLK(IO13) ── R7(2.2K) ──┬── Q1 基极(B)
                                 │
                              R8(10K)
                                 │
                                GND
```

工作原理：
- IO13输出HIGH → Q1导通 → LED-K接通GND → 背光亮
- IO13输出LOW → Q1截止 → 电路断开 → 背光灭
- IO13输出PWM → Q1快速开关 → 背光亮度可调

> **方案B中R7和R8的作用**：R7(2.2K)限制流入三极管基极的电流，防止GPIO过载。R8(10K)是基极下拉电阻，在MCU上电前GPIO还是高阻态时，确保三极管关断，避免背光闪烁。这个设计和屏幕数据手册第7页的参考原理图完全一致。

### 操作步骤

**1. 连接SPI信号线（用网络标签）**

在J3的对应引脚上放置网络标签：

| J3引脚 | 网络标签 | 对应ESP32-S3引脚 | 说明 |
|--------|---------|-----------------|------|
| Pin 7 (DCX) | `LCD_DC` | IO10 | 数据/命令选择 |
| Pin 8 (CSX) | `LCD_CS` | IO9 | 片选 |
| Pin 9 (SCL) | `SPI_SCK` | IO12 | SPI时钟线 |
| Pin 10 (SDA) | `SPI_MOSI` | IO11 | SPI数据线 |
| Pin 11 (RESX) | `LCD_RST` | IO46 | 屏幕复位 |

> 这些标签名必须和你在ESP32-S3模组上放的标签**完全一致**。`SPI_SCK`、`SPI_MOSI`、`LCD_DC`、`LCD_CS`、`LCD_RST` 这5个已经在第一步画ESP32-S3时放好了。

**2. 连接电源**

- VDD (Pin 4) 连到 `3V3` 电源符号
- GND (Pin 1, 5, 6, 12) 全部连到 `GND` 符号

**3. 放置去耦电容C8**

- C8 (100nF) 一端连到 VDD (Pin 4) 的线上，另一端连到 GND
- **尽量靠近Pin 4放置**

**4. 连接背光电路**

**方案A（背光常亮，推荐新手）：**
- R6 (4.7Ω) 一端接 `3V3`，另一端接 LED-A (Pin 3)
- LED-K (Pin 2) 直接接 `GND`
- 不需要占用任何GPIO

**方案B（GPIO控制背光）：**
- R6 (4.7Ω) 一端接 `3V3`，另一端接 LED-A (Pin 3)
- LED-K (Pin 2) 接 Q1 的集电极(C)
- Q1 的发射极(E) 接 `GND`
- Q1 的基极(B) 通过 R7 (2.2K) 接网络标签 `LCD_BLK`
- Q1 的基极(B) 同时通过 R8 (10K) 接 `GND`
- 在ESP32-S3的IO13引脚上也放一个 `LCD_BLK` 标签

---

## 第七步：每个连接的详细解释

### SCL（SPI时钟线）— 和I2S的BCLK一样的概念

SCL是SPI通信的"节拍器"，ESP32-S3产生时钟信号，屏幕在每个时钟的上升沿读取数据。

ESP32-S3的SPI外设（叫SPI2或SPI3）最高可以输出80MHz的时钟。但屏幕这边的SPI写入时钟周期最小16ns（即最高62.5MHz），实际用多少取决于走线长度：

| SPI时钟频率 | 刷屏速度（240×240 RGB565） | 说明 |
|-----------|--------------------------|------|
| 20MHz | ~29fps | 保守，走线长也稳定 |
| 40MHz | ~58fps | 常用，大多数屏幕能跑 |
| 62.5MHz | ~91fps | 屏幕最高支持，需要走线短且干净 |

我们的项目显示简单内容（时间、天气、状态），20~40MHz就够了。频率在代码里设置，不需要改硬件。

> **SPI_SCK能和I2S_MIC_SCK或I2S_SPK_BCLK共用同一个引脚吗？** 不能。虽然名字里都有"时钟"，但它们是完全不同的外设——SPI和I2S是独立的硬件模块，各自需要自己的引脚。ESP32-S3有3组SPI和2组I2S，互不干扰。

### SDA/MOSI（数据线）— 为什么只需要一根？

SPI通常有两根数据线：
- **MOSI**（Master Out Slave In）：主控 → 从设备（我们需要）
- **MISO**（Master In Slave Out）：从设备 → 主控（读取屏幕数据用）

我们只需要**MOSI**（ESP32-S3 → 屏幕），因为我们只往屏幕"写"数据（发送像素），不需要从屏幕"读"数据。

> **屏幕数据手册里SDA的描述是"Serial data input/output pin"**：虽然写着"输入输出"，但我们只用它的输入功能（接收ESP32-S3发来的数据）。输出功能（MISO方向，用于读取屏幕寄存器）我们用不到。

### CSX（片选）— 为什么需要？

CSX = Chip Select（片选），是SPI总线的"点名"机制：

- CSX = LOW → "屏幕，我在跟你说话，注意听"
- CSX = HIGH → "屏幕，你可以休息了，我在跟别人说话"

当SPI总线上只有一个设备时，把CSX固定接GND也能工作（屏幕一直被选中）。但如果以后你想在同一组SPI总线上再接其他设备（比如SD卡），就需要CSX来区分。

我们保留CSX引脚接到IO9，更灵活。

### DCX（数据/命令选择）— ST7789最独特的线

DCX引脚告诉屏幕"我现在发的这个字节是什么意思"：

```text
发送一帧画面的典型流程：

1. DCX=LOW,  发送 0x2A  → 命令："设置列地址范围"
2. DCX=HIGH, 发送 0,0,0,239 → 参数：列地址0~239
3. DCX=LOW,  发送 0x2B  → 命令："设置行地址范围"
4. DCX=HIGH, 发送 0,0,0,239 → 参数：行地址0~239
5. DCX=LOW,  发送 0x2C  → 命令："开始写入像素数据"
6. DCX=HIGH, 发送 240×240×2 字节 → 数据：每个像素2字节(RGB565)
```

DCX引脚在每次发送前都要切换，所以它需要一个独立的GPIO来控制。这也是为什么ST7789的SPI叫"4线SPI"——标准SPI的3线（SCK+MOSI+CS）加上DCX这第4线。

### RESX（硬件复位）— 为什么需要？

RESX低电平有效：
- RESX = LOW → 屏幕复位（内部所有寄存器恢复默认值）
- RESX = HIGH → 屏幕正常工作

数据手册特别提到：**上电后必须执行一次硬件复位**（"Be sure to execute a power-on reset after supplying power"）。

上电时的初始化流程：
1. RESX拉低至少10微秒
2. RESX拉高
3. 等待120毫秒（让内部电路稳定）
4. 通过SPI发送初始化命令序列
5. 屏幕开始正常显示

> **RESX引脚需要上拉电阻吗？** ST7789内部有弱上拉，默认RESX是高电平。你不需要额外加外部上拉电阻。

### VDD（电源）— 为什么用3V3？

这块屏幕的VDD范围是2.4V~3.3V（典型2.75V）。我们系统的数字电源是3.3V，在范围内。

ST7789内部的DC/DC升压电路会自动产生液晶屏需要的其他电压（如AVDD、VGH、VGL等），你不用管这些。

> **能用5V供电吗？** 不能。绝对最大额定值是4.6V，超过会损坏。我们的3.3V在安全范围内。

### LED-A和LED-K（背光LED）— 为什么需要限流电阻？

背光LED和普通LED一样，需要限流电阻来控制通过它的电流。如果不加电阻，LED会因为过大电流而烧毁。

```text
电路原理：

3.3V ── R6(4.7Ω) ── LED-A(+) ──[背光LED]── LED-K(-) ── GND
                                    ↑
                              正向电压VF=3.0V

电阻上的电压 = 3.3V - 3.0V = 0.3V
通过LED的电流 = 0.3V / 4.7Ω ≈ 64mA（接近数据手册典型值60mA）
电阻功耗 = 0.3V × 64mA ≈ 19mW（0603电阻额定100mW，完全没问题）
```

> **为什么不能直接把LED-A接3.3V不加电阻？** 虽然LED正向电压（3.0V）和供电电压（3.3V）差距只有0.3V，好像不需要电阻，但LED的伏安特性是指数曲线——电压稍微升高一点，电流就会暴增。没有电阻限流的话，实际电流会远超正常值，LED会过热损坏。**必须加限流电阻。**

> **数据手册参考电路里LED-A接的是+3.0V没有电阻？** 对，因为参考电路用的是3.0V电源（和LED正向电压刚好相等），电压差为0，不需要电阻。但我们的系统是3.3V，有0.3V电压差，所以必须加限流电阻。

> **带PCB的模组为什么不需要你加电阻？** 因为模组的小PCB板上已经帮你焊好了限流电阻。裸屏没有这层，所以你得自己加。

### GND（地）— 为什么有4个GND引脚？

这块屏幕有4个GND引脚（Pin 1, 5, 6, 12），全部接地。多个GND引脚的原因和ESP32-S3一样——保证良好的接地参考，减少地回路阻抗。

---

## 第八步：SPI信号线的连接注意事项

### 为什么SPI不需要上拉/下拉电阻？

和I2C不同（I2C的SDA和SCL需要上拉电阻），SPI的每根线都是**推挽输出**（主动输出高电平和低电平），不需要外部电阻。直接连就行。

### SPI总线共享的可能性

ESP32-S3有3组SPI外设（SPI0/SPI1被内部Flash/PSRAM占用，SPI2和SPI3可用）。

我们用SPI2来驱动屏幕。如果以后想加SD卡模块（也是SPI接口），可以共用SPI2的SCK和MOSI线，只要给SD卡一个独立的CS引脚就行：

```text
ESP32-S3 SPI2:
  SCK  (IO12) ──┬── ST7789 SCL
                 └── SD卡 CLK
  MOSI (IO11) ──┬── ST7789 SDA
                 └── SD卡 MOSI
  CS1  (IO9)  ───── ST7789 CSX  （拉低选中屏幕）
  CS2  (IOxx) ───── SD卡 CS     （拉低选中SD卡）
```

同一时刻只有一个CS被拉低，所以两个设备不会冲突。

---

## 第九步：检查清单

画完后，逐项确认：

**FPC连接器和电源：**
- [ ] J3 (12P 0.5mm FPC连接器) 已放置
- [ ] Pin 1 (GND) 接GND
- [ ] Pin 4 (VDD) 接3V3
- [ ] Pin 5, 6 (GND) 接GND
- [ ] Pin 12 (GND) 接GND
- [ ] C8 (100nF) 接在VDD和GND之间，紧靠J3

**背光电路：**
- [ ] R6 (4.7Ω) 一端接3V3，另一端接Pin 3 (LED-A)
- [ ] Pin 2 (LED-K) 接GND（方案A）或接三极管Q1集电极（方案B）
- [ ] （方案B）Q1发射极接GND，基极通过R7(2.2K)接 `LCD_BLK` 标签
- [ ] （方案B）Q1基极通过R8(10K)接GND
- [ ] （方案B）已回到ESP32-S3原理图页面，在IO13上放了 `LCD_BLK` 标签

**SPI信号线：**
- [ ] Pin 7 (DCX) 标签 `LCD_DC` — 和ESP32-S3的IO10同名
- [ ] Pin 8 (CSX) 标签 `LCD_CS` — 和ESP32-S3的IO9同名
- [ ] Pin 9 (SCL) 标签 `SPI_SCK` — 和ESP32-S3的IO12同名
- [ ] Pin 10 (SDA) 标签 `SPI_MOSI` — 和ESP32-S3的IO11同名
- [ ] Pin 11 (RESX) 标签 `LCD_RST` — 和ESP32-S3的IO46同名
- [ ] 所有网络标签拼写与ESP32-S3上的完全一致

---

## 第十步：画完后你应该有这些元件

### 方案A（背光常亮）

| 类别 | 元件 | 位号 | 值/型号 | 数量 |
|------|------|------|--------|------|
| 接口 | FPC连接器 | J3 | 12P 0.5mm翻盖式 | 1 |
| 电源 | 去耦电容 | C8 | 100nF / 0603 | 1 |
| 背光 | 限流电阻 | R6 | 4.7Ω / 0603 | 1 |

**总计：1个FPC连接器 + 1个电容 + 1个电阻 + 5个网络标签**

### 方案B（GPIO控制背光）额外增加

| 类别 | 元件 | 位号 | 值/型号 | 数量 |
|------|------|------|--------|------|
| 背光 | NPN三极管 | Q1 | S8050 / SOT-23 | 1 |
| 背光 | 基极电阻 | R7 | 2.2K / 0603 | 1 |
| 背光 | 基极下拉 | R8 | 10K / 0603 | 1 |

**方案B总计：1个FPC连接器 + 1个电容 + 3个电阻 + 1个三极管 + 6个网络标签**

### 加上之前三个模块的元件汇总

| 模块 | 元件数 | 位号范围 |
|------|--------|---------|
| ESP32-S3最小系统 | 12个 | U1, C1-C4, R1-R4, SW1-SW2, J1 |
| INMP441麦克风 | 3个 | U2, C5, R5 |
| MAX98357A功放 | 4个 | U3, C6-C7, J2 |
| ST7789显示屏（方案A） | 3个 | J3, C8, R6 |
| **合计（方案A）** | **22个** | |

---

## 常见问题

**Q: 嘉立创EDA里搜12P 0.5mm FPC连接器怎么搜？**

0.5mm间距是最常见的FPC间距，搜索非常简单：
1. 搜 `FPC 12P 0.5` 或 `FPC 0.5mm 12`
2. 结果会非常多，选一个便宜的、有货的就行
3. 优先选嘉立创自营库（带蓝色"嘉"标志）

选择时注意：
- **间距**：必须是0.5mm
- **针数**：12P
- **类型**：翻盖式（Flip-Lock）最常用，容易操作
- **接触方向**：看你的屏幕FPC排线的金手指（金色触点）在哪一面，选对应的上接或下接

**Q: 上接（Top Contact）和下接（Bottom Contact）怎么选？**

看你的FPC排线末端：
- 金手指（金色触点）在**上面**（插入时朝上） → 选**上接**连接器
- 金手指在**下面**（插入时朝下） → 选**下接**连接器

数据手册机械图里标注了"Contact sides"的位置，可以参考。如果不确定，买屏幕时问卖家，或者拿到FPC排线后看一下就知道了。选错的话FPC插进去触点接不上，不会损坏但不工作。

**Q: 背光常亮方案（方案A）和GPIO控制方案（方案B）怎么选？**

| 对比 | 方案A（常亮） | 方案B（GPIO控制） |
|------|-------------|-----------------|
| 元件数 | 3个 | 6个 |
| 难度 | 简单 | 稍复杂（多了三极管和两个电阻） |
| 背光控制 | 不能，一直亮 | 可以开关、调亮度(PWM) |
| 省电 | 不省，背光一直耗约64mA | 不用时关掉背光省电 |
| 占GPIO | 不占 | 占IO13 |

**建议**：新手先用方案A，把东西跑起来再说。后面如果发现需要调亮度或省电，可以改PCB加三极管——或者直接在软件里不刷屏时把屏幕休眠（ST7789的SLPIN命令可以让屏幕进入低功耗模式，但背光还是亮的）。

**Q: 屏幕的VDD和麦克风的VDD都接3V3，会不会互相干扰？**

有可能。屏幕刷新时会有较大电流波动，可能通过3V3电源线影响到麦克风的供电，导致录音出现噪声。

解决办法：
1. **每个模块都加去耦电容**（我们已经做了——麦克风有C5，屏幕有C8）
2. **PCB布局时注意**：麦克风的3V3供电走线尽量独立，不要和屏幕的3V3走线共用太长的路径（叫"星型供电"布局）
3. **不要在录音时刷屏**（软件层面避开，或者降低SPI频率减少干扰）

这些是PCB布局和软件阶段的事，原理图阶段先不用担心。

**Q: SPI时钟频率越高越好吗？**

不是。频率越高，对PCB走线的要求越高。对于我们的1.54寸小屏幕（240×240 RGB565 = 115,200字节/帧），用40MHz的SPI大约可以刷到58fps，显示时间天气绰绰有余。屏幕最高支持62.5MHz（时钟周期最小16ns）。

**Q: FPC连接器焊接难吗？**

0.5mm间距的FPC连接器引脚很密，手焊有一定难度。如果你让嘉立创帮你贴片（SMT），完全不用担心焊接问题。如果手焊，需要：
- 细头烙铁（尖头或刀头）
- 助焊膏
- 放大镜或显微镜
- 耐心

新手建议让嘉立创帮你贴片，加几块钱的事。

**Q: 这块屏幕和之前讨论的WA54HC045I-12S有什么区别？**

| 对比 | T154H7-C12-01（现在用的） | WA54HC045I-12S（之前的） |
|------|--------------------------|------------------------|
| FPC间距 | **0.5mm**（标准，连接器好找） | 0.7mm（不常见，连接器难找） |
| 引脚数 | 12pin | 12pin |
| 引脚顺序 | 完全一样 | 完全一样 |
| 背光VF | 3.0V | ~3.1V |
| 背光IF | 60mA | ~42mA |
| VDD范围 | 2.4~3.3V | 2.5~3.3V |
| 驱动IC | ST7789 | ST7789V |

引脚顺序完全一致，SPI信号接法一样，唯一差别就是FPC间距。换成0.5mm解决了连接器找不到的问题。

---

## 下一步

ST7789显示屏接口画好后，你已经完成了所有外设模块（麦克风、功放、屏幕）。接下来画**TP4056 + AMS1117 电源管理电路**——这是给整个系统供电的"心脏"，USB充电和电池供电都靠它。

画完电源管理电路后，前面所有模块的电源（3V3、VBAT）就全部连通了。

准备好了就告诉我。
